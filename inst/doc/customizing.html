<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Customizing clean_metadata()</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Customizing
<code>clean_metadata()</code></h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(ARUtools)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>In our “Getting started” tutorial, we worked with a set of files that
matched the expected metadata patterns. However, this is probably not
going to be the case much of the time.</p>
<p>Here we’ll go over how to customize ARUtools functions to work with
your data.</p>
<p>For example, let’s assume your files look like this, with two
recordings, one at Site 100-a45 May 4th 2020 at 5:25 am with ARU unit
S4A1234. The other at Site 102-b56 on the same day but at 5:40 am with
ARU unit S4A1111.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="st">&quot;site100-a45/2020_05_04_05_25_00_s4a1234.wav&quot;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="st">&quot;site102-b56/2020_05_04_05_40_00_s4a1111.wav&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>)</span></code></pre></div>
<p>If we try to clean this with the default arguments, we’re going to
have some problems.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">clean_metadata</span>(<span class="at">project_files =</span> f)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; ✖ No times were successfully detected (2/2)</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; ✖ No ARU ids were successfully detected (2/2)</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; ✖ No sites were successfully detected (2/2)</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; 1 2020_05_04_0… wav   site… &lt;NA&gt;   Wildlife Ac… Song… SongMet… &lt;NA&gt;    &lt;NA&gt;     </span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; 2 2020_05_04_0… wav   site… &lt;NA&gt;   Wildlife Ac… Song… SongMet… &lt;NA&gt;    &lt;NA&gt;     </span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
<div id="regular-expressions" class="section level2">
<h2>Regular expressions</h2>
<p>First let’s talk a bit about how <code>clean_metadata()</code>
extracts information.</p>
<p>This function uses <a href="https://stringr.tidyverse.org/articles/regular-expressions.html">regular
expressions</a> to match specific text patterns in the file path of each
recording. Regular expressions are really powerful, but also reasonably
complicated and can be confusing.</p>
<p>For example, by default, <code>clean_metadata()</code> matches site
ids with the expression ((Q)|(P))(())(_|-)(()).</p>
<p>Yikes!</p>
<p>Broken down, that means look for a “Q” <em>or</em> “P”
(<code>((Q)|(P))</code>) followed by two digits (<code>\\d{2}</code>)
followed by a separator, either <code>_</code> <em>or</em>
<code>-</code> (<code>_|-</code>) followed by a single digit
(<code>\\d{1}</code>).</p>
<p>This clearly doesn’t define the sites in our example here. You can
supply your own regular expression, instead.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(<span class="at">project_files =</span> f, <span class="at">pattern_site_id =</span> <span class="st">&quot;site</span><span class="sc">\\</span><span class="st">d{3}-(a|b)</span><span class="sc">\\</span><span class="st">d{2}&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; ✖ No times were successfully detected (2/2)</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; ✖ No ARU ids were successfully detected (2/2)</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>m</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; 1 2020_05_04_0… wav   site… &lt;NA&gt;   Wildlife Ac… Song… SongMet… site10… &lt;NA&gt;     </span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; 2 2020_05_04_0… wav   site… &lt;NA&gt;   Wildlife Ac… Song… SongMet… site10… &lt;NA&gt;     </span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>m<span class="sc">$</span>site_id</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; [1] &quot;site100-a45&quot; &quot;site102-b56&quot;</span></span></code></pre></div>
<p>However, with sites that follow a reasonable pattern of a prefix,
followed by digits and optionally a suffix with digits, it might be
easier to use a helper function to create the regular expression for
you.</p>
<p>For example, to create a site id pattern we can use
<code>create_pattern_site_id()</code>.</p>
<p>We specify the <code>prefix</code> text as well as how many digits we
might expect, a separator, <code>suffix</code> text and how many suffix
digits there might be.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>pat_site <span class="ot">&lt;-</span> <span class="fu">create_pattern_site_id</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;site&quot;</span>, <span class="at">p_digits =</span> <span class="dv">3</span>,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="at">s_digits =</span> <span class="dv">2</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>pat_site</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;((site))((\\d{3}))(-)((b)|(a))((\\d{2}))&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(<span class="at">project_files =</span> f, <span class="at">pattern_site_id =</span> pat_site)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; ✖ No times were successfully detected (2/2)</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; ✖ No ARU ids were successfully detected (2/2)</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>m<span class="sc">$</span>site_id</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;site100-a45&quot; &quot;site102-b56&quot;</span></span></code></pre></div>
<p>It can be useful to look at the default patterns in the functions to
see what might be different in your data.</p>
<p>See <code>?create_pattern_date</code> or any
<code>create_pattern</code> function to pull up the documentation and
explore the defaults as well as examples.</p>
<p>It can also be useful to test out a pattern before running all your
files.</p>
<p>We can use the <code>test_pattern()</code> function to see if our
pattern successfully extracts the site id from the first file in our
list.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">test_pattern</span>(f[<span class="dv">1</span>], pat_site)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;site100-a45&quot;</span></span></code></pre></div>
<p>Let’s continue customizing our metadata patterns by specifying ARU
ids, dates and times.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>pat_aru <span class="ot">&lt;-</span> <span class="fu">create_pattern_aru_id</span>(<span class="at">arus =</span> <span class="st">&quot;s4a&quot;</span>, <span class="at">n_digits =</span> <span class="dv">4</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">project_files =</span> f,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="at">pattern_site_id =</span> pat_site,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="at">pattern_aru_id =</span> pat_aru,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="at">pattern_dt_sep =</span> <span class="st">&quot;_&quot;</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>m</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; 1 2020_05_04_0… wav   site… s4a12… Wildlife Ac… Song… SongMet… site10… &lt;NA&gt;     </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; 2 2020_05_04_0… wav   site… s4a11… Wildlife Ac… Song… SongMet… site10… &lt;NA&gt;     </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
</div>
<div id="other-options" class="section level2">
<h2>Other options</h2>
<div id="date-order" class="section level3">
<h3>Date order</h3>
<p>Depending on your date formatting, you may also need to specify the
order of the year, month and day, in addition to changing the
pattern.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="st">&quot;P01-1/05042020_052500_S4A1234.wav&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="st">&quot;P01-1/05042020_054000_S4A1111.wav&quot;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">clean_metadata</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="at">project_files =</span> f,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="at">pattern_dt_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">pattern_date =</span> <span class="fu">create_pattern_date</span>(<span class="at">order =</span> <span class="st">&quot;mdy&quot;</span>),</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">order_date =</span> <span class="st">&quot;mdy&quot;</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; 1 05042020_052… wav   P01-… S4A12… Wildlife Ac… Song… SongMet… P01-1   &lt;NA&gt;     </span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; 2 05042020_054… wav   P01-… S4A11… Wildlife Ac… Song… SongMet… P01-1   &lt;NA&gt;     </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
<p>Note that you need to specify it once when making the pattern, and
then again when telling the function how to turn the extracted text into
a date.</p>
<p>You can specify more than one order with
<code>c(&quot;mdy&quot;, &quot;ymd&quot;)</code>, but only do this if you <em>know</em> you
have multiple orders in the file names. In particular, try to avoid
using both <code>mdy</code> and <code>dmy</code>. Some of these dates
can be ambiguous (for example, what order is 05/05/2020?) and may not be
parsed correctly in these situations.</p>
</div>
<div id="matching-multiple-patterns" class="section level3">
<h3>Matching multiple patterns</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="st">&quot;P01-1/05042020_052500_S4A1234.wav&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="st">&quot;P01-1/05042020_054000_S4A1111.wav&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="st">&quot;Site10/2020-01-01T09:00:00_BARLT100.wav&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="st">&quot;Site10/2020-01-02T09:00:00_BARLT100.wav&quot;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>)</span></code></pre></div>
<p>Sometimes your files may use more than one pattern. You can address
this problem in one of two ways.</p>
<p><strong>One option is to run <code>clean_metadata()</code> twice and
then join the outputs</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">project_files =</span> f,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">pattern_dt_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="at">pattern_date =</span> <span class="fu">create_pattern_date</span>(<span class="at">order =</span> <span class="st">&quot;mdy&quot;</span>),</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="at">order_date =</span> <span class="st">&quot;mdy&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; ✖ Not all dates were successfully detected (2/4)</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; ✖ Not all times were successfully detected (2/4)</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; ✖ Not all ARU ids were successfully detected (2/4)</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; ✖ Not all sites were successfully detected (2/4)</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(m1, <span class="sc">!</span><span class="fu">is.na</span>(date_time)) <span class="co"># omit ones that didn&#39;t work</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>m1</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; 1 05042020_052… wav   P01-… S4A12… Wildlife Ac… Song… SongMet… P01-1   &lt;NA&gt;     </span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt; 2 05042020_054… wav   P01-… S4A11… Wildlife Ac… Song… SongMet… P01-1   &lt;NA&gt;     </span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(</span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>  <span class="at">project_files =</span> f,</span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>  <span class="at">pattern_site_id =</span> <span class="fu">create_pattern_site_id</span>(<span class="at">prefix =</span> <span class="st">&quot;Site&quot;</span>, <span class="at">s_digits =</span> <span class="dv">0</span>),</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>  <span class="at">pattern_aru_id =</span> <span class="fu">create_pattern_aru_id</span>(<span class="at">n_digits =</span> <span class="dv">3</span>)</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>)</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="co">#&gt; ✖ Not all dates were successfully detected (1/4)</span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a><span class="co">#&gt; ✖ Not all times were successfully detected (2/4)</span></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a><span class="co">#&gt; ✖ Not all sites were successfully detected (2/4)</span></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(m2, <span class="sc">!</span><span class="fu">is.na</span>(date_time)) <span class="co"># omit ones that didn&#39;t work</span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a>m2</span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a><span class="co">#&gt; 1 2020-01-01T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  &lt;NA&gt;     </span></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a><span class="co">#&gt; 2 2020-01-02T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  &lt;NA&gt;     </span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(m1, m2)</span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a>m</span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 11</span></span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a><span class="co">#&gt; 1 05042020_052… wav   P01-… S4A12… Wildlife Ac… Song… SongMet… P01-1   &lt;NA&gt;     </span></span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a><span class="co">#&gt; 2 05042020_054… wav   P01-… S4A11… Wildlife Ac… Song… SongMet… P01-1   &lt;NA&gt;     </span></span>
<span id="cb12-50"><a href="#cb12-50" tabindex="-1"></a><span class="co">#&gt; 3 2020-01-01T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  &lt;NA&gt;     </span></span>
<span id="cb12-51"><a href="#cb12-51" tabindex="-1"></a><span class="co">#&gt; 4 2020-01-02T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  &lt;NA&gt;     </span></span>
<span id="cb12-52"><a href="#cb12-52" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
<p>With this approach you should check that the number of files in the
end matches the number you expect.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">nrow</span>(m)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p><strong>Another option is to supply multiple patterns to
<code>clean_metadata()</code> or to the
<code>create_pattern_XXX()</code> functions</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="at">project_files =</span> f,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="at">pattern_dt_sep =</span> <span class="fu">c</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot;T&quot;</span>),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">pattern_date =</span> <span class="fu">create_pattern_date</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="st">&quot;ymd&quot;</span>, <span class="st">&quot;mdy&quot;</span>)),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="at">order_date =</span> <span class="fu">c</span>(<span class="st">&quot;ymd&quot;</span>, <span class="st">&quot;mdy&quot;</span>),</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="at">pattern_aru_id =</span> <span class="fu">create_pattern_aru_id</span>(<span class="at">n_digits =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)),</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="at">pattern_site_id =</span> <span class="fu">create_pattern_site_id</span>(</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="fu">c</span>(<span class="st">&quot;P&quot;</span>, <span class="st">&quot;Site&quot;</span>),</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>    <span class="at">sep =</span> <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>    <span class="at">s_digits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  )</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>m</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 11</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt; 1 05042020_052… wav   P01-… S4A12… Wildlife Ac… Song… SongMet… P01-1   &lt;NA&gt;     </span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="co">#&gt; 2 05042020_054… wav   P01-… S4A11… Wildlife Ac… Song… SongMet… P01-1   &lt;NA&gt;     </span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="co">#&gt; 3 2020-01-01T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  &lt;NA&gt;     </span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="co">#&gt; 4 2020-01-02T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  &lt;NA&gt;     </span></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
<p><strong>Which approach you should use depends on the
situation.</strong></p>
<p>The first approach means that the patterns being matched are more
rigid. There is less of a chance of accidentally matching an incorrect
pattern. However, there is a chance of omitting files that don’t match
either pattern.</p>
<p>The second approach is more flexible in matching patterns and allows
you to do so all in one step, which is convenient. However, the more
flexible a pattern is, the more opportunities there are to get incorrect
matches and date parsing.</p>
<p>With both approaches, it is important to double check the results and
make sure the ids and date/times make sense.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">check_meta</span>(m)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 11</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt;   site_id aru_type  aru_id   type  n_files n_dirs n_days min_date           </span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;   &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;dttm&gt;             </span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; 1 P01-1   SongMeter S4A1111  wav         1      1      1 2020-05-04 05:40:00</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; 2 P01-1   SongMeter S4A1234  wav         1      1      1 2020-05-04 05:25:00</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; 3 Site10  BARLT     BARLT100 wav         2      1      2 2020-01-01 09:00:00</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; # ℹ 3 more variables: max_date &lt;dttm&gt;, min_time &lt;time&gt;, max_time &lt;time&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="fu">check_meta</span>(m, <span class="at">date =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 10</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt;   site_id aru_type  aru_id   type  date       n_files n_dirs n_days min_time</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt; &lt;date&gt;       &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;time&gt;  </span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt; 1 P01-1   SongMeter S4A1111  wav   2020-05-04       1      1      1 05:40   </span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; 2 P01-1   SongMeter S4A1234  wav   2020-05-04       1      1      1 05:25   </span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt; 3 Site10  BARLT     BARLT100 wav   2020-01-01       1      1      1 09:00   </span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt; 4 Site10  BARLT     BARLT100 wav   2020-01-02       1      1      1 09:00   </span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable: max_time &lt;time&gt;</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="fu">check_problems</span>(m)</span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt; # A tibble: 0 × 6</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt; # ℹ 6 variables: path &lt;chr&gt;, aru_id &lt;chr&gt;, site_id &lt;chr&gt;, tz_offset &lt;chr&gt;,</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">#&gt; #   date_time &lt;dttm&gt;, date &lt;date&gt;</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="fu">unique</span>(m<span class="sc">$</span>site_id)</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="co">#&gt; [1] &quot;P01-1&quot;  &quot;Site10&quot;</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="fu">unique</span>(m<span class="sc">$</span>aru_id)</span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="co">#&gt; [1] &quot;S4A1234&quot;  &quot;S4A1111&quot;  &quot;BARLT100&quot;</span></span></code></pre></div>
</div>
<div id="subsetting-files" class="section level3">
<h3>Subsetting files</h3>
<p>You may not want to extract meta data for every file in your list or
directory. Possibly this is because they’re not relevant recordings, or
because you have some formatting issues that make it easier to split
into separate groups first.</p>
<p>You can omit files using the <code>subset</code> and
<code>subset_type</code> arguments.</p>
<p>To keep only certain files, use the default
<code>subset_type = &quot;keep&quot;</code>. To omit certain files, use
<code>subset_type = &quot;omit&quot;</code>.</p>
<p>To keep only files with the “a” prefix (note that <code>^</code>
means ‘at the start’)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">clean_metadata</span>(<span class="at">project_files =</span> example_files, <span class="at">subset =</span> <span class="st">&quot;^a&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 × 11</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; 1 P01_1_202005… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; 2 P01_1_202005… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; 3 P02_1_202005… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   &lt;NA&gt;     </span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; 4 P02_1_202005… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   &lt;NA&gt;     </span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; # ℹ 10 more rows</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
<p>To omit all files with the “a” prefix</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">clean_metadata</span>(<span class="at">project_files =</span> example_files, <span class="at">subset =</span> <span class="st">&quot;^a&quot;</span>, <span class="at">subset_type =</span> <span class="st">&quot;omit&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 28 × 11</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; 1 P01_1_202005… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; 2 P01_1_202005… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt; 3 P02_1_202005… wav   j_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   &lt;NA&gt;     </span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; 4 P02_1_202005… wav   j_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   &lt;NA&gt;     </span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; # ℹ 24 more rows</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
</div>
<div id="matching-non-wave-files" class="section level3">
<h3>Matching non-wave files</h3>
<p>By default <code>clean_metadata()</code> looks for .wav files. If you
want it to match something else, adjust the <code>file_type</code>
argument.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="st">&quot;a_BARLT10962_P01_1/P01_1_20200502T050000_ARU.mp4&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="st">&quot;a_BARLT10962_P01_1/P01_1_20200503T052000_ARU.mp4&quot;</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Other wise we’ll run into problems…</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">clean_metadata</span>(<span class="at">project_files =</span> f)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; Error in `clean_metadata()`:</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; ! Did not find any &#39;wav&#39; files.</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; ℹ Use `file_type` to change file extension for sound files</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; ℹ Check `project_dir`/`project_files` are correct</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">clean_metadata</span>(<span class="at">project_files =</span> f, <span class="at">file_type =</span> <span class="st">&quot;mp4&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt; 1 P01_1_202005… mp4   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   &lt;NA&gt;     </span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt; 2 P01_1_202005… mp4   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   &lt;NA&gt;     </span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
</div>
<div id="look-arounds" class="section level3">
<h3>Look arounds</h3>
<p>In some cases identifying what lies before or after a string of
interest can help with extracting the pattern of interest. Details of
look arounds can be found on the <a href="https://stringr.tidyverse.org/articles/regular-expressions.html#look-arounds">“stringr”</a>
package website.</p>
<p>The following code shows a set of files that contain repeated
patterns that match both site and project folders. If we run
<code>clean_metadata()</code> it fails to detect dates and times.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="st">&quot;//BARLTs/DeploymentProjectXYZsites_202223/XYZBrantAirstrip/20230519_RemoteTrip2223/00015998_20230519T210900-0400_SS23.wav&quot;</span>,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="st">&quot;//BARLTs/DeploymentProjectXYZsites_202223/XYZPermafrostPFSC-SP1/20230415_RemoteTrip2223/00015321_20230415T214700-0400_Owls23.wav&quot;</span>,</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  <span class="st">&quot;//BARLTs/DeploymentProjectXYZsites_202223/XYZfoxden30/20230623_RemoteTrip2223/00015370_20230623T062000-0400_SR23.wav&quot;</span>,</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="st">&quot;//BARLTs/DeploymentProjectXYZsites_202223/XYZfoxden107/20220922_RemoteTrip2223/00016130_20220922T000200-0400_NFC22.wav&quot;</span>,</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="st">&quot;//BARLTs/DeploymentProjectXYZsites_00202223/XYZfoxden107/20230711_RemoteTrip2223/00016130_20230711T093600-0400_SR23.wav&quot;</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  <span class="at">project_files =</span> f,</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>  <span class="at">pattern_site_id =</span> <span class="fu">create_pattern_site_id</span>(<span class="at">prefix =</span> <span class="st">&quot;XYZ</span><span class="sc">\\</span><span class="st">w+&quot;</span>, <span class="at">p_digits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">sep =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="at">s_digits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>),</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>  <span class="at">pattern_aru_id =</span> <span class="fu">create_pattern_aru_id</span>(<span class="at">arus =</span> <span class="st">&quot;&quot;</span>, <span class="at">n_digits =</span> <span class="dv">8</span>), <span class="at">quiet =</span> T</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>)</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="co">#&gt; ✖ No dates were successfully detected (5/5)</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="co">#&gt; ✖ No times were successfully detected (5/5)</span></span></code></pre></div>
<p>Even worse, it returns the wrong <code>site_id</code> values.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>m<span class="sc">$</span>site_id</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;XYZsites_202223&quot;   &quot;XYZsites_202223&quot;   &quot;XYZsites_202223&quot;  </span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&gt; [4] &quot;XYZsites_202223&quot;   &quot;XYZsites_00202223&quot;</span></span></code></pre></div>
<p>To tackle the <code>site_id</code> issue we can add a look behind to
clue into the directory before the <code>site_id</code> always ends with
“202223/”.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>m_site_id_fix <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="at">project_files =</span> f,</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="at">pattern_site_id =</span> <span class="fu">create_pattern_site_id</span>(</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="st">&quot;XYZ</span><span class="sc">\\</span><span class="st">w+&quot;</span>, <span class="at">p_digits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">sep =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="at">s_digits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>    <span class="at">look_behind =</span> <span class="st">&quot;202223/&quot;</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  ),</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  <span class="at">pattern_aru_id =</span> <span class="fu">create_pattern_aru_id</span>(<span class="at">arus =</span> <span class="st">&quot;&quot;</span>, <span class="at">n_digits =</span> <span class="dv">8</span>), <span class="at">quiet =</span> T</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>)</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt; ✖ No dates were successfully detected (5/5)</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt; ✖ No times were successfully detected (5/5)</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>m_site_id_fix<span class="sc">$</span>site_id</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a><span class="co">#&gt; [1] &quot;XYZBrantAirstrip&quot;  &quot;XYZPermafrostPFSC&quot; &quot;XYZfoxden30&quot;      </span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="co">#&gt; [4] &quot;XYZfoxden107&quot;      &quot;XYZfoxden107&quot;</span></span></code></pre></div>
<p>This corrects the <code>site_id</code> values but the generic
“pattern_aru_id” means that the <code>clean_metadata()</code> fails to
detect dates and time as the “pattern_aru_id” is excluded when looking
for dates and times.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>m_fix <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  <span class="at">project_files =</span> f,</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  <span class="at">pattern_site_id =</span> <span class="fu">create_pattern_site_id</span>(</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="st">&quot;XYZ</span><span class="sc">\\</span><span class="st">w+&quot;</span>, <span class="at">p_digits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">sep =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="at">s_digits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>    <span class="at">look_behind =</span> <span class="st">&quot;202223/&quot;</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>  ),</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>  <span class="at">pattern_aru_id =</span> <span class="fu">create_pattern_aru_id</span>(<span class="at">arus =</span> <span class="st">&quot;&quot;</span>, <span class="at">n_digits =</span> <span class="dv">8</span>, </span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>                                         <span class="at">sep =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>                                         <span class="at">look_behind =</span> <span class="st">&quot;RemoteTrip2223/&quot;</span>, </span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>                                         <span class="at">look_ahead =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>  <span class="at">quiet =</span> T</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>)</span></code></pre></div>
<p>In the end the look arounds helped us pull out stubborn
<code>site_id</code> vaules and separate overlapping patterns of
<code>aru_id</code> and dates and times.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
