<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Getting started with ARUtools</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Getting started with ARUtools</h1>



<p>The ARUtools package aims to make processing of large quantities of
acoustic recordings easier through automation of metadata processing and
sub-sampling of recordings.</p>
<p>Prior to working on your ARU recordings or meta data you must:</p>
<ul>
<li><p>Know your goals of interpreting recordings</p></li>
<li><p>Transferred your recordings to a suitable and organized location
for processing</p></li>
<li><p>Prepare your site information so it can be linked with the
recordings</p></li>
</ul>
<p>This introduction will walk through the first few steps of extracting
the metadata, adding site information, and calculating sunrise and
sunset information.</p>
<div id="read-file-metadata" class="section level2">
<h2>Read file metadata</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(ARUtools)</span></code></pre></div>
<p>Let’s use some example data to get started.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">head</span>(example_files)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a_BARLT10962_P01_1/P01_1_20200502T050000-0400_ARU.wav&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; [2] &quot;a_BARLT10962_P01_1/P01_1_20200503T052000-0400_ARU.wav&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; [3] &quot;a_S4A01234_P02_1/P02_1_20200504T052500_ARU.wav&quot;       </span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; [4] &quot;a_S4A01234_P02_1/P02_1_20200505T073000_ARU.wav&quot;       </span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; [5] &quot;a_BARLT10962_P03_1/P03_1_20200506T100000-0400_ARU.wav&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; [6] &quot;a_BARLT11111_P04_1/P04_1_20200506T050000-0400_ARU.wav&quot;</span></span></code></pre></div>
<p>This is a list of hypothetical ARU files from different sites, and
using different ARUs. This is fairly messily organized data in that
there is no clear structure to the folders and there appear to be
unneeded characters in the files. However give the standard structure of
site names, ARU ID codes, and datetime stamps, we can extract that
information from the file structure alone.</p>
<p>First things first, we’ll clean up the meta data associated with the
files.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(<span class="at">project_files =</span> example_files)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; Extracting ARU info...</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; Extracting Dates and Times...</span></span></code></pre></div>
<p>Because our example files follow the standard formats for Site ID,
ARU Id, and date/time, we can extract all the information without having
to change any of the default arguments.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>m</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 42 × 11</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; 1 P01_1_202005… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; 2 P01_1_202005… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; 3 P02_1_202005… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   &lt;NA&gt;     </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; 4 P02_1_202005… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   &lt;NA&gt;     </span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; # ℹ 38 more rows</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></code></pre></div>
<p>If you were reading directly from files you would assign a base
directory and then have <code>clean_metadata</code> read the files in
that folder and sub-folders.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>base_directory <span class="ot">&lt;-</span> <span class="st">&quot;/path/to/project/files/&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">clean_metadata</span>(<span class="at">project_dir =</span> base_directory)</span></code></pre></div>
</div>
<div id="add-coordinates" class="section level2">
<h2>Add coordinates</h2>
<p>Next, we want to add our coordinates to this data.</p>
<p>If your data has GPS logs included, they would have been detected in
the above step and you could now use <code>g &lt;- clean_gps(m)</code>
to create a list of GPS coordinates.</p>
<p>However, many models of ARUs do not have an internal GPS and those
that do, may not accurately record the location where the ARU is
deployed to. Therefore we recommend that you create a site index file to
manually record deployment locations, like this one.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>example_sites</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt;    Sites Date_set_out Date_removed        ARU    lon    lat Plots Subplot</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; 1  P01_1   2020-05-01   2020-05-03 BARLT10962 -85.03 50.010 Plot1       a</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; 2  P02_1   2020-05-03   2020-05-05   S4A01234 -87.45 52.680 Plot1       a</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; 3  P03_1   2020-05-05   2020-05-06 BARLT10962 -90.38 48.990 Plot2       a</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; 4  P04_1   2020-05-05   2020-05-07 BARLT11111 -85.53 45.000 Plot2       a</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; 5  P05_1   2020-05-06   2020-05-07 BARLT10962 -88.45 51.050 Plot3       b</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; 6  P06_1   2020-05-08   2020-05-09 BARLT10962 -90.08 52.000 Plot1       a</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; 7  P07_1   2020-05-08   2020-05-10   S4A01234 -86.03 50.450 Plot1       a</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; 8  P08_1   2020-05-10   2020-05-11 BARLT10962 -84.45 48.999 Plot2       a</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; 9  P09_1   2020-05-10   2020-05-11   S4A02222 -91.38 45.000 Plot2       a</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; 10 P10_1   2020-05-10   2020-05-11   S4A03333 -90.00 50.010 Plot3       b</span></span></code></pre></div>
<p>While you can simply specify a single date, it is recommended that
you use both a start date and an end date for the best matching. This is
critical if you are moving your ARUs during a season.</p>
<p>Now let’s clean up this list so we can add these sites to our
metadata.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">clean_site_index</span>(example_sites)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; Error in `clean_site_index()`:</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; ! Problems with data `site_index`:</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; • Column &#39;site_id&#39; does not exist</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; • Column &#39;date&#39; does not exist</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; • Column &#39;aru_id&#39; does not exist</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; • Column &#39;longitude&#39; does not exist</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; • Column &#39;latitude&#39; does not exist</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; • See ?clean_site_index</span></span></code></pre></div>
<p>Ooops! We can see right away that <code>clean_site_index()</code>
expects the data to be in a particular format. Luckily we can let it
know if we’ve used a different format.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">clean_site_index</span>(example_sites,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">name_aru_id =</span> <span class="st">&quot;ARU&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">name_site_id =</span> <span class="st">&quot;Sites&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">name_date_time =</span> <span class="fu">c</span>(<span class="st">&quot;Date_set_out&quot;</span>, <span class="st">&quot;Date_removed&quot;</span>),</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="at">name_coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; There are overlapping date ranges</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; • Shifting start/end times to &#39;noon&#39;</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; • Skip this with `resolve_overlaps = FALSE`</span></span></code></pre></div>
<p>Hmm, that’s an interesting message! This means that some of our
deployment dates overlap. ARUtools assumes that if you set out an ARU on
a specific day, you probably didn’t set it out at midnight (i.e. the
very start of that day). Since we assume you are likely using ARUs for
recording in the early morning or late at night, we shift the dates
start/end times to noon as an estimate of when the ARU was likely
deployed.</p>
<p>If your ARU was deployed at midnight, use
<code>resolve_ovelaps = FALSE</code>. Or, if you know the exact time
your ARU was deployed, use a date/time rather than just a date in your
site index.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>sites</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 8</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt;   site_id aru_id   date_time_start     date_time_end       date_start date_end  </span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dttm&gt;              &lt;dttm&gt;              &lt;date&gt;     &lt;date&gt;    </span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; 1 P01_1   BARLT10… 2020-05-01 12:00:00 2020-05-03 12:00:00 2020-05-01 2020-05-03</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; 2 P02_1   S4A01234 2020-05-03 12:00:00 2020-05-05 12:00:00 2020-05-03 2020-05-05</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; 3 P03_1   BARLT10… 2020-05-05 12:00:00 2020-05-06 12:00:00 2020-05-05 2020-05-06</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; 4 P04_1   BARLT11… 2020-05-05 12:00:00 2020-05-07 12:00:00 2020-05-05 2020-05-07</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; # ℹ 6 more rows</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: longitude &lt;dbl&gt;, latitude &lt;dbl&gt;</span></span></code></pre></div>
<p>Note that we’ve lost a couple of non-standard columns:
<code>Plots</code> and <code>Subplot</code>.</p>
<p>We can retain these by specifying <code>cols_extra</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">clean_site_index</span>(example_sites,</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="at">name_aru_id =</span> <span class="st">&quot;ARU&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="at">name_site_id =</span> <span class="st">&quot;Sites&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">name_date_time =</span> <span class="fu">c</span>(<span class="st">&quot;Date_set_out&quot;</span>, <span class="st">&quot;Date_removed&quot;</span>),</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">name_coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="at">name_extra =</span> <span class="fu">c</span>(<span class="st">&quot;Plots&quot;</span>, <span class="st">&quot;Subplot&quot;</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; There are overlapping date ranges</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; • Shifting start/end times to &#39;noon&#39;</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; • Skip this with `resolve_overlaps = FALSE`</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>sites</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 10</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;   site_id aru_id   date_time_start     date_time_end       date_start date_end  </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dttm&gt;              &lt;dttm&gt;              &lt;date&gt;     &lt;date&gt;    </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; 1 P01_1   BARLT10… 2020-05-01 12:00:00 2020-05-03 12:00:00 2020-05-01 2020-05-03</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; 2 P02_1   S4A01234 2020-05-03 12:00:00 2020-05-05 12:00:00 2020-05-03 2020-05-05</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; 3 P03_1   BARLT10… 2020-05-05 12:00:00 2020-05-06 12:00:00 2020-05-05 2020-05-06</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; 4 P04_1   BARLT11… 2020-05-05 12:00:00 2020-05-07 12:00:00 2020-05-05 2020-05-07</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; # ℹ 6 more rows</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt; # ℹ 4 more variables: longitude &lt;dbl&gt;, latitude &lt;dbl&gt;, Plots &lt;chr&gt;,</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt; #   Subplot &lt;chr&gt;</span></span></code></pre></div>
<p>We can even be fancy and rename them for consistency by using named
vectors.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">clean_site_index</span>(example_sites,</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="at">name_aru_id =</span> <span class="st">&quot;ARU&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="at">name_site_id =</span> <span class="st">&quot;Sites&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="at">name_date_time =</span> <span class="fu">c</span>(<span class="st">&quot;Date_set_out&quot;</span>, <span class="st">&quot;Date_removed&quot;</span>),</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="at">name_coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="at">name_extra =</span> <span class="fu">c</span>(<span class="st">&quot;plot&quot;</span> <span class="ot">=</span> <span class="st">&quot;Plots&quot;</span>, <span class="st">&quot;subplot&quot;</span> <span class="ot">=</span> <span class="st">&quot;Subplot&quot;</span>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; There are overlapping date ranges</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; • Shifting start/end times to &#39;noon&#39;</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; • Skip this with `resolve_overlaps = FALSE`</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>sites</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 10</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt;   site_id aru_id   date_time_start     date_time_end       date_start date_end  </span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dttm&gt;              &lt;dttm&gt;              &lt;date&gt;     &lt;date&gt;    </span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; 1 P01_1   BARLT10… 2020-05-01 12:00:00 2020-05-03 12:00:00 2020-05-01 2020-05-03</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; 2 P02_1   S4A01234 2020-05-03 12:00:00 2020-05-05 12:00:00 2020-05-03 2020-05-05</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; 3 P03_1   BARLT10… 2020-05-05 12:00:00 2020-05-06 12:00:00 2020-05-05 2020-05-06</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; 4 P04_1   BARLT11… 2020-05-05 12:00:00 2020-05-07 12:00:00 2020-05-05 2020-05-07</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; # ℹ 6 more rows</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; # ℹ 4 more variables: longitude &lt;dbl&gt;, latitude &lt;dbl&gt;, plot &lt;chr&gt;,</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt; #   subplot &lt;chr&gt;</span></span></code></pre></div>
<p>Now let’s add this site-related information to our metadata.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">add_sites</span>(m, sites)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; Joining by columns `date_time_start` and `date_time_end`</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>m</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 42 × 15</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    </span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; 1 P01_1_202005… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; 2 P01_1_202005… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; 3 P02_1_202005… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   &lt;NA&gt;     </span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; 4 P02_1_202005… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   &lt;NA&gt;     </span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; # ℹ 38 more rows</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; # ℹ 6 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;, longitude &lt;dbl&gt;,</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; #   latitude &lt;dbl&gt;, plot &lt;chr&gt;, subplot &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="calculate-times-to-sunrise-and-sunset" class="section level2">
<h2>Calculate times to sunrise and sunset</h2>
<p>Great! We have all the site-related information to describe that
recording.</p>
<p>Now to prepare for our selection procedure, the last thing we need to
do is calculate the time to sunrise or sunset.</p>
<p>Here we need to be clear about what timezone the ARU unit was
recording times as.</p>
<p>There are two options.</p>
<p>The first option is that all ARUs were set up at home base before
deployment. In this case it’s possible they were deployed in a location
with a different timezone than what they were recording in. This doesn’t
matter, as long as you specify the programmed timezone here. In this
case, use <code>tz = &quot;America/Toronto&quot;</code>, or whichever time zone
was used. Note that timezones must be one of
<code>OlsonNames()</code>.</p>
<p>The second option is that each ARU unit was set up to record in the
local timezone where it was placed. If this is the case, specify
<code>tz = &quot;local&quot;</code> and the <code>calc_sun()</code> function will
use coordinates to determine local timezones.</p>
<p>(See the Dealing with Timezones vignette for more details).</p>
<p>In our example, let’s assume that the ARUs were set up in each
location they were deployed. So we’ll use <code>tz = &quot;local&quot;</code>, the
default setting.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">calc_sun</span>(m)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(m)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; Rows: 42</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; Columns: 18</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; $ file_name    &lt;chr&gt; &quot;P01_1_20200502T050000-0400_ARU.wav&quot;, &quot;P01_1_20200503T052…</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; $ type         &lt;chr&gt; &quot;wav&quot;, &quot;wav&quot;, &quot;wav&quot;, &quot;wav&quot;, &quot;wav&quot;, &quot;wav&quot;, &quot;wav&quot;, &quot;wav&quot;, &quot;…</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; $ path         &lt;chr&gt; &quot;a_BARLT10962_P01_1/P01_1_20200502T050000-0400_ARU.wav&quot;, …</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; $ aru_id       &lt;chr&gt; &quot;BARLT10962&quot;, &quot;BARLT10962&quot;, &quot;S4A01234&quot;, &quot;S4A01234&quot;, &quot;BARL…</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; $ manufacturer &lt;chr&gt; &quot;Frontier Labs&quot;, &quot;Frontier Labs&quot;, &quot;Wildlife Acoustics&quot;, &quot;…</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; $ model        &lt;chr&gt; &quot;BAR-LT&quot;, &quot;BAR-LT&quot;, &quot;Song Meter 4&quot;, &quot;Song Meter 4&quot;, &quot;BAR-…</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; $ aru_type     &lt;chr&gt; &quot;BARLT&quot;, &quot;BARLT&quot;, &quot;SongMeter&quot;, &quot;SongMeter&quot;, &quot;BARLT&quot;, &quot;BAR…</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; $ site_id      &lt;chr&gt; &quot;P01_1&quot;, &quot;P01_1&quot;, &quot;P02_1&quot;, &quot;P02_1&quot;, &quot;P03_1&quot;, &quot;P04_1&quot;, &quot;P0…</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; $ tz_offset    &lt;chr&gt; &quot;-0400&quot;, &quot;-0400&quot;, NA, NA, &quot;-0400&quot;, &quot;-0400&quot;, &quot;-0400&quot;, &quot;-04…</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt; $ date_time    &lt;dttm&gt; 2020-05-02 05:00:00, 2020-05-03 05:20:00, 2020-05-04 05:…</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; $ date         &lt;date&gt; 2020-05-02, 2020-05-03, 2020-05-04, 2020-05-05, 2020-05-…</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt; $ longitude    &lt;dbl&gt; -85.03, -85.03, -87.45, -87.45, -90.38, -85.53, -85.53, -…</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt; $ latitude     &lt;dbl&gt; 50.010, 50.010, 52.680, 52.680, 48.990, 45.000, 45.000, 5…</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; $ plot         &lt;chr&gt; &quot;Plot1&quot;, &quot;Plot1&quot;, &quot;Plot1&quot;, &quot;Plot1&quot;, &quot;Plot2&quot;, &quot;Plot2&quot;, &quot;Pl…</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt; $ subplot      &lt;chr&gt; &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;b&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a…</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">#&gt; $ tz           &lt;chr&gt; &quot;America/Toronto&quot;, &quot;America/Toronto&quot;, &quot;America/Toronto&quot;, …</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co">#&gt; $ t2sr         &lt;dbl&gt; -74.933333, -53.216667, -47.250000, 79.616667, 207.133333…</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co">#&gt; $ t2ss         &lt;dbl&gt; 479.9500, 498.4167, 483.4167, 606.6833, -685.8833, 486.18…</span></span></code></pre></div>
<p>Tada! Now we have a complete set of cleaned metadata associated with
each recording.</p>
<p>This is a very simple example and much of the pain in large projects
comes from complications, so be sure to check out
<code>vignette(&quot;customizing&quot;)</code> and
<code>vignette(&quot;spatial&quot;)</code> to dig into some of these issues.</p>
</div>
<div id="next-steps" class="section level2">
<h2>Next steps</h2>
<p>Now that we have a set of cleaned metadata the next step is to select
recordings. To do this using a random sampling approach check out the
subsampling article <code>vignette(&quot;SubSample&quot;)</code>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
